#!/bin/bash
# Ghosttyç»ˆç«¯é—´é€šä¿¡æ¼”ç¤ºè„šæœ¬

# æ¼”ç¤ºå¦‚ä½•åœ¨Ghosttyä¸­å®ç°ç±»ä¼¼tmuxçš„ç»ˆç«¯é—´é€šä¿¡åŠŸèƒ½

echo "=== Ghostty Terminal Communication Demo ==="
echo ""
echo "è¿™ä¸ªæ¼”ç¤ºå±•ç¤ºäº†Ghosttyå¦‚ä½•å®ç°ç»ˆç«¯é—´é€šä¿¡åŠŸèƒ½"
echo ""

# åœºæ™¯1: æœ¬åœ°ç»ˆç«¯é—´é€šä¿¡
echo "ğŸ“ åœºæ™¯1: æœ¬åœ°ç»ˆç«¯é—´é€šä¿¡"
echo "========================================="
echo ""
echo "å¯åŠ¨ä¸¤ä¸ªGhosttyç»ˆç«¯ï¼š"
echo "  Terminal A: ghostty --session-id terminal-a"
echo "  Terminal B: ghostty --session-id terminal-b"
echo ""
echo "åœ¨Terminal Aä¸­å‘é€å‘½ä»¤åˆ°Terminal Bï¼š"
echo "  $ @send terminal-b 'echo \"Hello from Terminal A\"'"
echo "  æˆ–"
echo "  $ echo 'ls -la' | ghostty send terminal-b"
echo ""
echo "å»ºç«‹åŒå‘é“¾æ¥ï¼ˆæ‰€æœ‰è¾“å‡ºåŒæ­¥ï¼‰ï¼š"
echo "  $ @link terminal-b"
echo ""

# åœºæ™¯2: SSHè¿œç¨‹é€šä¿¡
echo "ğŸ“ åœºæ™¯2: SSHè¿œç¨‹é€šä¿¡"
echo "========================================="
echo ""
echo "æœ¬åœ°ç»ˆç«¯è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼š"
echo "  $ ghostty --session-id local"
echo "  $ ssh user@remote-host"
echo ""
echo "è¿œç¨‹ç»ˆç«¯è‡ªåŠ¨æ³¨å†Œï¼ˆé€šè¿‡Shell Integrationï¼‰ï¼š"
echo "  remote$ # GHOSTTY_SESSION_IDå·²è‡ªåŠ¨è®¾ç½®"
echo "  remote$ @register-remote local"
echo ""
echo "æœ¬åœ°å‘é€å‘½ä»¤åˆ°è¿œç¨‹ï¼š"
echo "  local$ @send remote 'uname -a'"
echo ""
echo "è¿œç¨‹å‘é€ç»“æœå›æœ¬åœ°ï¼š"
echo "  remote$ @send local 'Remote execution complete'"
echo ""

# åœºæ™¯3: å®ç”¨æ¡ˆä¾‹
echo "ğŸ“ åœºæ™¯3: å®ç”¨æ¡ˆä¾‹"
echo "========================================="
echo ""
echo "1ï¸âƒ£ å¼€å‘ç¯å¢ƒï¼ˆç¼–è¾‘å™¨+ç¼–è¯‘å™¨+æ—¥å¿—ï¼‰ï¼š"
echo "   editor$ @link compiler --on-save"
echo "   compiler$ @link logger"
echo "   # ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨ç¼–è¯‘ï¼Œç»“æœæ˜¾ç¤ºåœ¨æ—¥å¿—çª—å£"
echo ""
echo "2ï¸âƒ£ åä½œè°ƒè¯•ï¼š"
echo "   dev1$ @link dev2 --bidirectional"
echo "   # ä¸¤ä¸ªå¼€å‘è€…çš„ç»ˆç«¯å®Œå…¨åŒæ­¥"
echo ""
echo "3ï¸âƒ£ è¿œç¨‹ååŠ©ï¼š"
echo "   support$ ssh customer@remote"
echo "   support$ @link-back --view-only"
echo "   # å®¢æˆ·å¯ä»¥çœ‹åˆ°æ”¯æŒäººå‘˜çš„æ“ä½œ"
echo ""

# æŠ€æœ¯å®ç°ç»†èŠ‚
echo "ğŸ“ æŠ€æœ¯å®ç°"
echo "========================================="
echo ""
echo "æ¶æ„å±‚æ¬¡ï¼š"
echo "  Appå±‚ (SessionManager) â† ç±»ä¼¼tmux server"
echo "    â†“"
echo "  Surfaceå±‚ (ç»ˆç«¯å®ä¾‹)"
echo "    â†“"
echo "  Termioå±‚ (PTYæ§åˆ¶)"
echo ""
echo "é€šä¿¡æœºåˆ¶ï¼š"
echo "  â€¢ æœ¬åœ°: D-Bus IPC + ç›´æ¥PTYå†™å…¥"
echo "  â€¢ è¿œç¨‹: OSC 777åºåˆ— + Shell Integration"
echo ""
echo "å…³é”®ä»£ç è·¯å¾„ï¼š"
echo "  1. App.zig â†’ SessionManager"
echo "  2. Surface.zig â†’ session_id + routing"
echo "  3. apprt/ipc.zig â†’ send_to_session action"
echo "  4. termio/Termio.zig â†’ backend.write()"
echo ""

# OSCåºåˆ—åè®®
echo "ğŸ“ OSC 777é€šä¿¡åè®®"
echo "========================================="
echo ""
echo "å»ºç«‹é€šä¿¡é€šé“ï¼š"
echo '  ESC]777;ghostty-comm;setup;session-id\a'
echo ""
echo "å‘é€æ•°æ®ï¼š"
echo '  ESC]777;ghostty-comm;data;target;base64-data\a'
echo ""
echo "æ³¨å†Œè¿œç¨‹ï¼š"
echo '  ESC]777;ghostty-comm;register;local;remote\a'
echo ""

# å‘½ä»¤è¡Œæ¥å£
echo "ğŸ“ å‘½ä»¤è¡Œæ¥å£"
echo "========================================="
echo ""
echo "å¤–éƒ¨å‘½ä»¤ï¼š"
echo "  ghostty send <session-id> <command>"
echo "  ghostty link <session-id> [--bidirectional]"
echo "  ghostty sessions"
echo "  ghostty unlink <session-id>"
echo ""
echo "å†…éƒ¨å‘½ä»¤ï¼ˆåœ¨ç»ˆç«¯å†…ä½¿ç”¨ï¼‰ï¼š"
echo "  @send <session-id> <command>"
echo "  @link <session-id>"
echo "  @unlink <session-id>"
echo "  @sessions"
echo "  @status"
echo ""

# ä¸tmuxå¯¹æ¯”
echo "ğŸ“ ä¸tmuxå¯¹æ¯”"
echo "========================================="
echo ""
echo "ä¼˜åŠ¿ï¼š"
echo "  âœ… åŸç”Ÿé›†æˆï¼Œæ— éœ€é¢å¤–è¿›ç¨‹"
echo "  âœ… æ›´å¥½çš„æ€§èƒ½ï¼ˆå‡å°‘IPCå¼€é”€ï¼‰"
echo "  âœ… SSHé€æ˜æ”¯æŒ"
echo "  âœ… æ›´ç®€æ´çš„å‘½ä»¤"
echo "  âœ… å¯è§†åŒ–ä¼šè¯ç®¡ç†"
echo ""
echo "ç›¸ä¼¼åŠŸèƒ½ï¼š"
echo "  â€¢ send-keys â†’ @send"
echo "  â€¢ attach-session â†’ @link"
echo "  â€¢ list-sessions â†’ @sessions"
echo "  â€¢ new-session â†’ ghostty --session-id"
echo ""

echo "=== Demo Complete ==="
echo ""
echo "è¿™ä¸ªåŠŸèƒ½å®Œå…¨å¯ä»¥åœ¨Ghosttyä¸­å®ç°ï¼Œ"
echo "å¹¶ä¸”æ¯”tmuxæ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆï¼"