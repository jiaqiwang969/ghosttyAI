# QA-002 任务清单 - 测试工程师
## 第一周：网格操作测试

### 任务概览
**角色**：Test Engineer (Grid Operations)  
**任务ID**：T-105  
**预计工期**：2天  
**开始时间**：2025-01-09 (周四)  
**完成时间**：2025-01-10 (周五)  

### 主要任务：网格操作单元测试开发

#### 输入 (Inputs)
1. **开发交付物**
   - CORE-002 的 `backend_router.c` (周四获得)
   - INTG-001 的 `backend_ghostty.c` (周四获得)
   - CORE-001 的 hooks 实现

2. **测试规范** (来自 QA-001)
   - 测试框架结构
   - 测试用例模板
   - 覆盖率要求

3. **源代码参考**
   - `/Users/jqwang/98-ghosttyAI/tmux/grid.c`
   - `/Users/jqwang/98-ghosttyAI/tmux/grid-view.c`

#### 输出 (Outputs)
1. **test_grid_ops.c** - 网格操作测试套件
   ```c
   // 测试用例结构
   void test_grid_basic_write(void);
   void test_grid_unicode_emoji(void);
   void test_grid_wide_chars(void);
   void test_grid_scrolling(void);
   void test_grid_attributes(void);
   void test_grid_performance(void);
   ```

2. **test_fixtures/** - 测试数据
   ```
   test_fixtures/
   ├── unicode_samples.txt    # Unicode 测试数据
   ├── emoji_test.txt        # Emoji 测试
   ├── cjk_wide.txt         # 中日韩宽字符
   └── ansi_sequences.txt   # ANSI 转义序列
   ```

3. **coverage_report.html** - 覆盖率报告
   - 目标：>95% 网格操作覆盖
   - 分支覆盖率 >80%

4. **performance_baseline.json** - 性能基准
   ```json
   {
     "grid_write": {"avg_ns": 150, "max_ns": 500},
     "grid_scroll": {"avg_ns": 1000, "max_ns": 5000},
     "span_merge": {"reduction": "65%"}
   }
   ```

#### 具体步骤 (Steps)

**周四：测试开发**
1. **9:00-10:00** - 获取并理解开发交付物
2. **10:00-12:00** - 编写基础测试
   ```c
   void test_grid_basic_write(void) {
       struct grid *g = grid_create(80, 24);
       struct grid_cell cell = {.data = 'A', .attr = 0};
       
       grid_set_cell(g, 0, 0, &cell);
       assert(grid_get_cell(g, 0, 0)->data == 'A');
       
       grid_destroy(g);
   }
   ```
3. **13:00-15:00** - 编写 Unicode/Emoji 测试
   ```c
   void test_grid_unicode_emoji(void) {
       // 测试 emoji 🎉
       // 测试组合字符 é (e + ́)
       // 测试 Zero Width Joiner
   }
   ```
4. **15:00-17:00** - 编写宽字符测试
5. **17:00-18:00** - 初步测试运行

**周五：测试执行和优化**
1. **9:00-10:00** - 性能测试开发
2. **10:00-11:00** - 运行完整测试套件
3. **11:00-12:00** - 生成覆盖率报告
4. **13:00-14:00** - 修复发现的问题
5. **14:00-15:00** - 性能基准测试
6. **15:00-16:00** - 最终测试运行
7. **16:00-17:00** - 提交给 QA-001
8. **17:00-18:00** - 参与集成测试

#### 测试场景 (Test Scenarios)

**1. 基础网格操作**
- 单字符写入/读取
- 行/列操作
- 清屏操作
- 滚动（上/下）

**2. Unicode 处理**
- ASCII (1 byte)
- Latin-1 (2 bytes)
- CJK (3 bytes)
- Emoji (4 bytes)
- 组合字符
- Zero-width 字符

**3. 宽字符处理**
```c
// 中文宽字符测试
void test_cjk_wide_chars(void) {
    const char *text = "你好世界";
    // 每个中文字符占 2 列
    assert(string_width(text) == 8);
}
```

**4. 属性测试**
- 前景色/背景色
- 粗体/斜体/下划线
- 反转/闪烁
- 256色/真彩色

**5. 边界条件**
- 空网格
- 满网格
- 超长行
- 大量滚动

**6. 性能测试**
```c
void test_performance_bulk_write(void) {
    struct timespec start, end;
    clock_gettime(CLOCK_MONOTONIC, &start);
    
    // 写入 1MB 文本
    for (int i = 0; i < 1000000; i++) {
        grid_write_char(grid, 'A' + (i % 26));
    }
    
    clock_gettime(CLOCK_MONOTONIC, &end);
    uint64_t elapsed_ns = timespec_diff_ns(&end, &start);
    
    // 应该在 100ms 内完成
    assert(elapsed_ns < 100000000);
}
```

#### 验收标准 (Acceptance Criteria)
- [ ] 所有基础操作测试通过
- [ ] Unicode/Emoji 正确处理
- [ ] 宽字符显示正确
- [ ] 性能达到基准要求
- [ ] 代码覆盖率 >95%
- [ ] 无内存泄漏（valgrind 检查）

#### 测试工具 (Test Tools)
```bash
# 运行测试
make test-grid

# 覆盖率
make coverage

# 内存检查
valgrind --leak-check=full ./test_grid_ops

# 性能分析
perf record ./test_grid_ops
perf report
```

#### 协作要求 (Collaboration)
- **依赖 CORE-002**：需要 backend router
- **依赖 INTG-001**：需要 Ghostty backend
- **汇报给 QA-001**：测试结果和覆盖率

#### Bug 报告模板 (Bug Report Template)
```markdown
**Bug ID**: BUG-001
**严重性**: P0/P1/P2
**组件**: Grid Operations
**描述**: [问题描述]
**重现步骤**:
1. [步骤1]
2. [步骤2]
**期望结果**: [期望]
**实际结果**: [实际]
**影响**: [影响范围]
```

#### 每日汇报 (Daily Report)
```
STATUS [QA-002] [日期]
任务：T-105 网格操作测试
编写用例：[数量]
执行用例：[通过/失败]
覆盖率：[百分比]
Bug发现：[数量和严重性]
阻塞：[如有]
```